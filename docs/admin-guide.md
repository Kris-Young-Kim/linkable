# LinkAble 관리자 페이지 사용 가이드

## 목차

1. [관리자 권한 설정](#관리자-권한-설정)
2. [관리자 대시보드](#관리자-대시보드)
3. [상품 관리](#상품-관리)
4. [자주 묻는 질문](#자주-묻는-질문)

---

## 관리자 권한 설정

### 관리자 권한이란?

LinkAble 관리자 페이지에 접근하려면 **관리자(admin)** 또는 **전문가(expert)** 권한이 필요합니다.

### 권한 설정 방법

1. **Clerk 대시보드 접속**

   - [Clerk Dashboard](https://dashboard.clerk.com)에 로그인

2. **사용자 선택**

   - 사용자 목록에서 관리자 권한을 부여할 사용자를 선택

3. **Private Metadata 설정**

   - 사용자 상세 페이지에서 "Private metadata" 섹션으로 이동
   - 다음 JSON을 추가:

   ```json
   {
     "role": "admin"
   }
   ```

   - 또는 전문가 권한:

   ```json
   {
     "role": "expert"
   }
   ```

4. **저장 및 확인**
   - "Save" 버튼 클릭
   - 해당 사용자가 로그인하면 헤더에 "관리자" 링크가 표시됩니다

### 권한 확인

- 관리자 권한이 설정된 사용자는 헤더 우측에 "관리자" 버튼이 표시됩니다
- 클릭 시 `/admin/dashboard`로 이동합니다

---

## 관리자 대시보드

**URL**: `/admin/dashboard`

### 접근 방법

1. 헤더의 "관리자" 버튼 클릭
2. 또는 직접 `/admin/dashboard` URL로 접근

### 주요 기능

#### 1. 전체 플랫폼 통계

전체 사용자의 활동을 종합한 통계를 확인할 수 있습니다.

**표시되는 지표:**

- **추천 정확도**: 클릭률(CTR), 전체 추천 수, 클릭된 추천 수
- **K-IPPA 참여율**: 참여율, 전체 평가 수, 평가 가능한 추천 수
- **상담 완료율**: 완료율, 전체 상담 수, 완료된 상담 수
- **최근 활동**: 최근 30일간의 추천 수, K-IPPA 평가 수
- **평균 효과성 점수**: 전체 사용자의 평균 효과성 점수

**사용 방법:**

- 페이지 로드 시 자동으로 최신 통계가 표시됩니다
- 데이터는 실시간으로 업데이트됩니다

#### 2. 사용자별 종합 데이터

각 사용자의 상세 활동 데이터를 확인할 수 있습니다.

**표시되는 정보:**

- **사용자 정보**: 이름, 이메일, 역할
- **상담 통계**: 전체 상담 수, 완료된 상담 수
- **추천 통계**: 전체 추천 수, 클릭된 추천 수
- **K-IPPA 평가**: 평가 수, 평가 기록 수
- **평균 효과성 점수**: 사용자의 평균 효과성 점수
- **점수 변화 추이**: 점수 상승/하락 여부 및 변화량
- **포인트**: 현재 보유 포인트

**필터링 옵션:**

- **전체 사용자**: 모든 사용자 표시
- **K-IPPA 평가 완료**: K-IPPA 평가를 완료한 사용자만 표시
- **활성 사용자**: 상담을 진행한 사용자만 표시

**사용 방법:**

1. 상단 탭에서 원하는 필터 선택
2. 사용자 목록에서 각 사용자의 상세 정보 확인
3. 점수 변화 추이는 화살표(↑↓)와 숫자로 표시됩니다

---

## 상품 관리

**URL**: `/admin/products`

> 📖 **상세 가이드**: 상품 등록 방법에 대한 자세한 내용은 [상품 등록 가이드](./product-registration-guide.md)를 참고하세요.

### 접근 방법

1. 관리자 대시보드에서 사이드 네비게이션의 "상품 관리" 클릭
2. 또는 직접 `/admin/products` URL로 접근

### 주요 기능

#### 1. 새 상품 등록

ISO 9999 코드에 해당하는 보조기기 상품을 등록할 수 있습니다.

**등록 가능한 필드:**

- **상품 이름** (필수): 상품의 이름
- **ISO 코드** (필수): ISO 9999 코드 (예: "15 09", "12 22")
- **가격** (선택): 상품 가격 (원 단위)
- **구매 링크** (선택): 쿠팡, 네이버 등 구매 링크
- **이미지 URL** (선택): 상품 이미지 URL
- **제조사** (선택): 제조사명
- **카테고리** (선택): 플랫폼 정보 (예: "coupang", "naver")
- **설명** (선택): 상품에 대한 상세 설명

**사용 방법:**

1. 페이지 상단의 "새 상품 등록" 카드에서 폼 작성
2. 필수 필드(상품 이름, ISO 코드) 입력
3. 선택 필드 입력 (가능한 모든 정보를 입력하는 것을 권장)
4. "상품 등록" 버튼 클릭
5. 성공 메시지 확인

**주의사항:**

- 상품 이름과 ISO 코드는 필수입니다
- 가격은 숫자만 입력 가능합니다
- 구매 링크는 유효한 URL 형식이어야 합니다
- 이미지 URL은 공개 접근 가능한 URL이어야 합니다

#### 2. 상품 수정

등록된 상품의 정보를 수정할 수 있습니다.

**수정 가능한 필드:**

- 모든 등록 필드 (이름, ISO 코드, 가격, 구매 링크, 이미지 URL, 제조사, 카테고리, 설명)
- **활성 상태**: Switch 토글로 활성/비활성 전환

**사용 방법:**

1. 수정할 상품 카드에서 "수정" 버튼 클릭
2. 수정 모드로 전환되면 모든 필드가 편집 가능한 상태가 됩니다
3. 원하는 필드 수정
4. 활성 상태는 Switch로 토글 가능
5. "저장" 버튼 클릭하여 변경사항 저장
6. "취소" 버튼으로 수정 취소 가능

**활성 상태:**

- **활성**: 상품이 추천 목록에 표시됩니다
- **비활성**: 상품이 추천 목록에서 제외됩니다 (데이터는 유지)

#### 3. 상품 삭제

등록된 상품을 삭제할 수 있습니다.

**사용 방법:**

1. 삭제할 상품 카드에서 "삭제" 버튼 클릭
2. 확인 대화상자에서 "확인" 클릭
3. 상품이 데이터베이스에서 완전히 삭제됩니다

**주의사항:**

- 삭제된 상품은 복구할 수 없습니다
- 해당 상품과 연결된 추천 데이터는 유지되지만, 상품 정보는 표시되지 않습니다

#### 4. 상품 목록 확인

등록된 모든 상품을 확인할 수 있습니다.

**표시되는 정보:**

- 상품 이름
- ISO 코드 배지
- 활성/비활성 상태 배지
- ISO 코드별 상품 개수
- 최종 업데이트 날짜
- 상품 설명
- 가격, 제조사, 카테고리
- 구매 링크 (클릭 가능)
- 이미지 미리보기 (있는 경우)

**정렬:**

- 상품 목록은 최근 업데이트 순으로 정렬됩니다

---

## 자주 묻는 질문

### Q1. 관리자 권한이 설정되었는데도 접근이 안 됩니다.

**A**: 다음을 확인해주세요:

1. Clerk 대시보드에서 Private Metadata에 `{"role": "admin"}`이 정확히 설정되었는지 확인
2. 브라우저를 새로고침하거나 로그아웃 후 다시 로그인
3. 브라우저 개발자 도구(F12)의 콘솔에서 에러 메시지 확인

### Q2. 상품을 등록했는데 추천 목록에 나타나지 않습니다.

**A**: 다음을 확인해주세요:

1. 상품의 `is_active` 상태가 "활성"인지 확인
2. ISO 코드가 올바르게 입력되었는지 확인
3. 상품이 해당 ISO 코드로 추천되는지 확인 (ICF 분석 결과와 ISO 매핑 확인)

### Q3. 상품 이미지가 표시되지 않습니다.

**A**: 다음을 확인해주세요:

1. 이미지 URL이 공개 접근 가능한지 확인 (CORS 설정)
2. 이미지 URL 형식이 올바른지 확인 (http:// 또는 https://로 시작)
3. 이미지 파일이 실제로 존재하는지 확인

### Q4. 사용자 데이터가 표시되지 않습니다.

**A**: 다음을 확인해주세요:

1. 데이터베이스에 사용자 데이터가 있는지 확인
2. 브라우저 콘솔에서 에러 메시지 확인
3. 네트워크 탭에서 API 요청이 성공했는지 확인

### Q5. 통계 데이터가 정확하지 않습니다.

**A**: 다음을 확인해주세요:

1. 데이터베이스의 최신 데이터 확인
2. 통계 계산 로직 확인 (API 엔드포인트: `/api/admin/analytics`)
3. 시간대 설정 확인

### Q6. 상품을 삭제했는데 추천에 여전히 나타납니다.

**A**:

- 삭제된 상품은 데이터베이스에서 제거되지만, 이미 생성된 추천(`recommendations` 테이블)에는 기록이 남아있을 수 있습니다
- 추천 데이터는 상품 삭제와 무관하게 유지됩니다
- 새로운 추천 생성 시에는 삭제된 상품이 포함되지 않습니다

---

## 추가 정보

### API 엔드포인트

관리자 기능은 다음 API 엔드포인트를 사용합니다:

- `GET /api/admin/analytics` - 전체 플랫폼 통계
- `GET /api/admin/users` - 사용자별 종합 데이터
- `GET /api/admin/products` - 상품 목록 조회
- `POST /api/admin/products` - 새 상품 등록
- `PATCH /api/admin/products/[id]` - 상품 수정
- `DELETE /api/admin/products/[id]` - 상품 삭제

### 로그 확인

관리자 작업은 서버 콘솔에 로그가 기록됩니다:

- 상품 생성/수정/삭제 시 로그 기록
- 사용자 데이터 조회 시 로그 기록
- 에러 발생 시 상세 로그 기록

### 보안

- 모든 관리자 API는 관리자 권한(`admin` 또는 `expert`)을 확인합니다
- 권한이 없는 사용자는 403 Forbidden 에러를 받습니다
- Private Metadata는 서버에서만 접근 가능하므로 클라이언트에서 조작할 수 없습니다

---

## 관련 문서

- [상품 등록 가이드](./product-registration-guide.md) - 상품 등록 방법 상세 가이드
- [상품 동기화 계획](./product-sync-plan.md) - 상품 데이터 수집 전략
- [ISO 9999:2022 매핑 참조 가이드](./iso-9999-2022-mapping-reference.md) - ISO 코드 매핑 규칙

---

## 문의 및 지원

관리자 페이지 사용 중 문제가 발생하면:

1. 브라우저 개발자 도구(F12)에서 에러 메시지 확인
2. 서버 로그 확인
3. 데이터베이스 상태 확인

---

**최종 업데이트**: 2025년 1월
